<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>MapLibreum Map</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <link href="https://unpkg.com/maplibre-gl@3.4.0/dist/maplibre-gl.css" rel="stylesheet" onerror="this.onerror=null;this.href='https://cdn.jsdelivr.net/npm/maplibre-gl@3.4.0/dist/maplibre-gl.css';" />
    
    
    
    <link href="https://unpkg.com/@maplibre/maplibre-gl-geocoder@latest/dist/maplibre-gl-geocoder.css" rel="stylesheet" onerror="console.warn('Failed to load geocoder CSS')" />
    
    
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #maplibreum_9ad8bbb5970e4e5982a1c308b44073cb {
            width: 100%;
            height: 500px;
            position: relative;
        }

        .maplibreum-legend {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.8);
            padding: 6px;
            font-size: 12px;
            border-radius: 4px;
        }

        .maplibreum-legend div {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }

        .maplibreum-legend span {
            display: inline-block;
            width: 12px;
            height: 12px;
            margin-right: 4px;

        }

        #maplibreum_9ad8bbb5970e4e5982a1c308b44073cb { width: 100%; height: 500px; }



    </style>
    
</head>
<body>
<div class="maplibreum-example-banner">
  <h1>Geocode With Nominatim With Python Api</h1>
  <p>Generated from test_geocode_with_nominatim_with_python_api.py by the automated test suite.</p>
</div>

    <div id="maplibreum_9ad8bbb5970e4e5982a1c308b44073cb">
        
        
    </div>
    <!-- MapLibre GL JS with CDN fallbacks -->
    <script>
        // Function to load MapLibre GL JS with fallbacks
        function loadMapLibreGL() {
            return new Promise((resolve, reject) => {
                // Try loading from unpkg.com first
                const script1 = document.createElement('script');
                script1.src = 'https://unpkg.com/maplibre-gl@3.4.0/dist/maplibre-gl.js';
                script1.onload = () => resolve();
                script1.onerror = () => {
                    // Fallback to jsDelivr
                    const script2 = document.createElement('script');
                    script2.src = 'https://cdn.jsdelivr.net/npm/maplibre-gl@3.4.0/dist/maplibre-gl.js';
                    script2.onload = () => resolve();
                    script2.onerror = () => {
                        // Last fallback to cdnjs
                        const script3 = document.createElement('script');
                        script3.src = 'https://cdnjs.cloudflare.com/ajax/libs/maplibre-gl/3.4.0/maplibre-gl.min.js';
                        script3.onload = () => resolve();
                        script3.onerror = () => reject(new Error('Failed to load MapLibre GL JS from all CDNs'));
                        document.head.appendChild(script3);
                    };
                    document.head.appendChild(script2);
                };
                document.head.appendChild(script1);
            });
        }

        // Function to show error message when MapLibre fails to load
        function showMapError(message) {
            const mapDiv = document.getElementById('maplibreum_9ad8bbb5970e4e5982a1c308b44073cb');
            if (mapDiv) {
                mapDiv.innerHTML = `
                    <div style="
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        height: 100%;
                        background-color: #f8f9fa;
                        border: 2px dashed #dee2e6;
                        border-radius: 8px;
                        text-align: center;
                        padding: 20px;
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
                    ">
                        <div>
                            <div style="font-size: 48px; color: #6c757d; margin-bottom: 16px;">üó∫Ô∏è</div>
                            <div style="font-size: 18px; color: #495057; margin-bottom: 8px;">Map Loading Error</div>
                            <div style="font-size: 14px; color: #6c757d; margin-bottom: 16px;">${message}</div>
                            <div style="font-size: 12px; color: #6c757d;">
                                This may be due to network restrictions or CDN availability issues.
                                <br>Try refreshing the page or check your internet connection.
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        class MaplibreumDeckGLOverlayManager {
            constructor(map, overlays) {
                this.map = map;
                this.configs = {};
                this.activeLayers = {};
                this.dataCache = {};
                this.pendingData = {};
                (overlays || []).forEach((overlay) => {
                    const normalised = Object.assign({}, overlay);
                    const props = normalised.props || {};
                    normalised.props = {
                        json: Object.assign({}, props.json || {}),
                        raw: Object.assign({}, props.raw || {}),
                    };
                    this.configs[normalised.id] = normalised;
                });
            }

            _getConfig(id) {
                const config = this.configs[id];
                if (!config) {
                    console.warn(`Deck.GL overlay '${id}' is not registered.`);
                }
                return config;
            }

            _resolveData(config) {
                const cacheKey = config.id;
                if (Object.prototype.hasOwnProperty.call(this.dataCache, cacheKey)) {
                    return Promise.resolve(this.dataCache[cacheKey]);
                }
                if (!config.data) {
                    return Promise.resolve(undefined);
                }
                if (config.data.mode === 'inline') {
                    this.dataCache[cacheKey] = config.data.value;
                    return Promise.resolve(config.data.value);
                }
                if (config.data.mode === 'promise') {
                    if (this.pendingData[cacheKey]) {
                        return this.pendingData[cacheKey];
                    }
                    let factory;
                    try {
                        factory = new Function(`return (${config.data.value});`);
                    } catch (error) {
                        return Promise.reject(error);
                    }
                    let promise;
                    try {
                        promise = Promise.resolve(factory());
                    } catch (error) {
                        return Promise.reject(error);
                    }
                    this.pendingData[cacheKey] = promise
                        .then((result) => {
                            delete this.pendingData[cacheKey];
                            this.dataCache[cacheKey] = result;
                            return result;
                        })
                        .catch((error) => {
                            delete this.pendingData[cacheKey];
                            throw error;
                        });
                    return this.pendingData[cacheKey];
                }
                return Promise.resolve(undefined);
            }

            _buildProps(config, data) {
                const jsonProps = (config.props && config.props.json) || {};
                const props = Object.assign({ data }, jsonProps);
                const rawProps = (config.props && config.props.raw) || {};
                Object.entries(rawProps).forEach(([key, value]) => {
                    try {
                        props[key] = eval('(' + value + ')');
                    } catch (error) {
                        console.warn(`Failed to evaluate Deck.GL property '${key}'`, error);
                    }
                });
                return props;
            }

            addOverlay(id) {
                if (this.activeLayers[id]) {
                    return this.activeLayers[id];
                }
                const config = this._getConfig(id);
                if (!config) {
                    return null;
                }
                if (typeof deck === 'undefined') {
                    console.error('Deck.GL library is not loaded');
                    return null;
                }
                const customLayer = {
                    id: config.id,
                    type: 'custom',
                    renderingMode: '3d',
                    onAdd: (map, gl) => {
                        customLayer.__cancelled = false;
                        this._resolveData(config)
                            .then((data) => {
                                if (customLayer.__cancelled) {
                                    return;
                                }
                                try {
                                    const layerProps = this._buildProps(config, data);
                                    customLayer.__deck = new deck.Deck({
                                        gl,
                                        map,
                                        initialViewState: map.getFreeCameraOptions(),
                                        layers: [new deck[config.layerType](layerProps)],
                                    });
                                } catch (error) {
                                    console.error(
                                        `Failed to initialise Deck.GL overlay ${config.id}`,
                                        error
                                    );
                                }
                            })
                            .catch((error) => {
                                console.error(
                                    `Failed to load data for Deck.GL overlay ${config.id}`,
                                    error
                                );
                            });
                    },
                    render: () => {
                        if (customLayer.__deck && this.map.getFreeCameraOptions) {
                            const viewState = this.map.getFreeCameraOptions();
                            customLayer.__deck.setProps({ viewState });
                        }
                    },
                    onRemove: () => {
                        customLayer.__cancelled = true;
                        if (customLayer.__deck) {
                            customLayer.__deck.finalize();
                            customLayer.__deck = null;
                        }
                    },
                };
                try {
                    this.map.addLayer(customLayer, config.before || undefined);
                    this.activeLayers[id] = customLayer;
                } catch (error) {
                    console.error(`Failed to add Deck.GL overlay ${config.id}`, error);
                }
                return customLayer;
            }

            removeOverlay(id) {
                const layer = this.activeLayers[id];
                if (!layer) {
                    return;
                }
                layer.__cancelled = true;
                try {
                    this.map.removeLayer(id);
                } catch (error) {
                    console.warn(`Failed to remove Deck.GL overlay ${id}`, error);
                }
                if (layer.__deck) {
                    layer.__deck.finalize();
                    layer.__deck = null;
                }
                delete this.activeLayers[id];
            }
        }

        // Load MapLibre and initialize map
        loadMapLibreGL().then(() => {
            // MapLibre loaded successfully, check if it's available
            if (typeof maplibregl === 'undefined') {
                throw new Error('MapLibre GL JS loaded but not available');
            }
            

            initializeMap();
        }).catch(error => {
            console.error('Failed to load MapLibre GL JS:', error);
            showMapError('Failed to load MapLibre GL JavaScript library');
        });

        function initializeMap() {
            try {
        // Initialize map
        var map = new maplibregl.Map({"container": "maplibreum_9ad8bbb5970e4e5982a1c308b44073cb", "style": "https://tiles.openfreemap.org/styles/bright", "center": [-87.61694, 41.86625], "zoom": 15.99, "pitch": 40, "bearing": 20});
        window.maplibreumMaps = window.maplibreumMaps || {};
        window.maplibreumMaps["maplibreum_9ad8bbb5970e4e5982a1c308b44073cb"] = map;
        window.maplibreumMapsLoaded = window.maplibreumMapsLoaded || {};
        map.once('load', function() {
            window.maplibreumMapsLoaded["maplibreum_9ad8bbb5970e4e5982a1c308b44073cb"] = true;
        });


// Add controls






map.on('load', function() {
    
    // Add sources
    

    // Register images used by style layers
    

    
    

    // Add layers
    



    // Popups
    

    // Tooltips
    

    // Tile Layers
    var tileLayers = [
    
    ];

    // Overlay Layers
    var overlayLayers = [
    
    ];

    

    

    // Markers
    

    

    

    

    

    // Queued camera actions
    
});

    

    

    
(function() {
    const geocoderApi = 
            {
                forwardGeocode: async (config) => {
                    const nominatimResponse = {
                        features: [
                            {
                                bbox: [-87.627815, 41.867576, -87.615211, 41.87221],
                                properties: { display_name: 'Museum Campus, Chicago, Illinois, United States' },
                            },
                        ],
                    };
                    const featureCollection = nominatimResponse.features.map((feature) => {
                        const center = [
                            feature.bbox[0] + (feature.bbox[2] - feature.bbox[0]) / 2,
                            feature.bbox[1] + (feature.bbox[3] - feature.bbox[1]) / 2,
                        ];
                        return {
                            type: 'Feature',
                            geometry: { type: 'Point', coordinates: center },
                            place_name: feature.properties.display_name,
                            properties: feature.properties,
                            text: feature.properties.display_name,
                            place_type: ['place'],
                            center,
                        };
                    });
                    return { features: featureCollection };
                },
            }
            ;
    const geocoder = new MaplibreGeocoder(geocoderApi, {
        maplibregl: maplibregl,
        placeholder: 'Search',
        marker: true,
        showResultPopup: true,
        ...{}
    });
    map.addControl(geocoder, 'top-left');
})();


            } catch (error) {
                console.error('Error initializing map:', error);
                showMapError('Error initializing the map: ' + error.message);
            }
        }
    </script>
    
    <!-- Load additional libraries with fallbacks -->
    
    
    
    
    <script src="https://unpkg.com/@maplibre/maplibre-gl-geocoder@latest/dist/maplibre-gl-geocoder.min.js" onerror="console.warn('Failed to load geocoder')"></script>
    
</body>

</html>